/*! socket-event 2015-11-06 */
"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0,h=j=void 0}},_multiEvent=require("multi-event"),_multiEvent2=_interopRequireDefault(_multiEvent),SocketEvent=function(a){function b(a){var c=a.io,d=a.socket;_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this._io=c,this._socket=d,this._pipedEventsSet=new Set}return _inherits(b,a),_createClass(b,[{key:"remoteEmit",value:function(a,b){(this._io||this._socket).emit(a,b)}},{key:"localEmit",value:function(a,c){_get(Object.getPrototypeOf(b.prototype),"emit",this).call(this,a,args)}},{key:"emit",value:function(){this.remoteEmit.apply(this,arguments),this.localEmit.apply(this,arguments)}},{key:"on",value:function(a,c){_get(Object.getPrototypeOf(b.prototype),"on",this).call(this,a,c),this.pipeFromRemote({eventName:a})}},{key:"pipeFromSocket",value:function(a){var c=this,d=a.eventName,e=a.socket,f=void 0===e?this._socket:e;f.on(d,function(){for(var a,e=arguments.length,f=Array(e),g=0;e>g;g++)f[g]=arguments[g];(a=_get(Object.getPrototypeOf(b.prototype),"emit",c)).call.apply(a,[c,d].concat(f))})}},{key:"pipeFromRemote",value:function(a){var b=this,c=a.eventName;this._pipedEventsSet.has(c)||(this._socket?this.pipeFromSocket({eventName:c}):this._io.on("connection",function(a){b.pipeFromSocket({eventName:c,socket:a})}),this._pipedEventsSet.add(c))}}]),b}(_multiEvent2["default"]);exports["default"]=SocketEvent,module.exports=exports["default"];